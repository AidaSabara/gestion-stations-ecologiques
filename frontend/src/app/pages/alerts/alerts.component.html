<!-- Ajoutez ce bloc AU D√âBUT de votre alerts.component.html -->

<!-- Bouton retour et titre (si station sp√©cifique) -->
<div class="container-fluid py-3 bg-light border-bottom" *ngIf="isStationSpecific">
  <div class="container">
    <div class="d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">

        <div>
          <h5 class="mb-0">
            <i class="bi bi-bell-fill text-danger me-2"></i>
            Alertes - {{ stationName }}
          </h5>
          <small class="text-muted">Alertes sp√©cifiques √† cette station</small>
        </div>
      </div>
      <span class="badge bg-danger fs-6">{{ activeAlertsCount }} actives</span>
    </div>
  </div>
</div>

<!-- Titre normal (si vue globale) -->
<div class="container-fluid py-3 bg-light border-bottom" *ngIf="!isStationSpecific">
  <div class="container">
    <h5 class="mb-0">
      <i class="bi bi-bell-fill text-danger me-2"></i>
      Toutes les alertes
    </h5>
  </div>
</div>


<div class="container-fluid py-4">
  <!-- En-t√™te -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 mb-1">
        <i class="bi bi-bell-fill text-warning me-2"></i>
        Alertes en Temps R√©el
      </h1>
      <p class="text-muted mb-0">
        {{ filteredAlerts.length }} alerte(s) - Surveillance en direct
      </p>
    </div>
    <a [routerLink]="['/']" class="btn btn-outline-primary">
      <i class="bi bi-arrow-left me-2"></i>
      Retour √† l'accueil
    </a>
  </div>

  <!-- Statistiques -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card border-danger">
        <div class="card-body text-center">
          <i class="bi bi-exclamation-triangle-fill text-danger fs-1"></i>
          <h3 class="mt-2">{{ criticalAlertsCount }}</h3>
          <p class="text-muted mb-0">Critiques</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-warning">
        <div class="card-body text-center">
          <i class="bi bi-exclamation-circle-fill text-warning fs-1"></i>
          <h3 class="mt-2">{{ highAlertsCount }}</h3>
          <p class="text-muted mb-0">√âlev√©es</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-primary">
        <div class="card-body text-center">
          <i class="bi bi-bell-fill text-primary fs-1"></i>
          <h3 class="mt-2">{{ activeAlertsCount }}</h3>
          <p class="text-muted mb-0">Actives</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-success">
        <div class="card-body text-center">
          <i class="bi bi-check-circle-fill text-success fs-1"></i>
          <h3 class="mt-2">{{ resolvedAlertsCount }}</h3>
          <p class="text-muted mb-0">R√©solues</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtres -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h6 class="fw-bold mb-3">Filtrer par statut</h6>
          <div class="btn-group" role="group">
            <button type="button"
                    class="btn btn-outline-secondary"
                    [class.active]="filterStatus === 'all'"
                    (click)="setFilter('all')">
              Toutes ({{ totalAlertsCount }})
            </button>
            <button type="button"
                    class="btn btn-outline-danger"
                    [class.active]="filterStatus === 'active'"
                    (click)="setFilter('active')">
              <i class="bi bi-bell-fill me-1"></i>
              Actives ({{ activeAlertsCount }})
            </button>
            <button type="button"
                    class="btn btn-outline-success"
                    [class.active]="filterStatus === 'resolved'"
                    (click)="setFilter('resolved')">
              <i class="bi bi-check-circle me-1"></i>
              R√©solues ({{ resolvedAlertsCount }})
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h6 class="fw-bold mb-3">Filtrer par s√©v√©rit√©</h6>
          <div class="btn-group" role="group">
            <button type="button"
                    class="btn btn-outline-secondary btn-sm"
                    [class.active]="filterSeverity === 'all'"
                    (click)="setSeverityFilter('all')">
              Toutes
            </button>
            <button type="button"
                    class="btn btn-outline-danger btn-sm"
                    [class.active]="filterSeverity === 'critical'"
                    (click)="setSeverityFilter('critical')">
              Critiques
            </button>
            <button type="button"
                    class="btn btn-outline-warning btn-sm"
                    [class.active]="filterSeverity === 'high'"
                    (click)="setSeverityFilter('high')">
              √âlev√©es
            </button>
            <button type="button"
                    class="btn btn-outline-info btn-sm"
                    [class.active]="filterSeverity === 'medium'"
                    (click)="setSeverityFilter('medium')">
              Moyennes
            </button>
          </div>
          <div class="text-muted text-end mt-2">
            <small>
              <i class="bi bi-clock me-1"></i>
              Derni√®re mise √† jour: {{ now | date:'HH:mm:ss' }}
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-2 text-muted">Analyse des donn√©es et d√©tection des alertes...</p>
  </div>

  <!-- Liste des alertes -->
  <div *ngIf="!isLoading" class="row">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">
            <i class="bi bi-list-ul me-2"></i>
            Liste des Alertes
          </h5>
          <span class="badge bg-warning">{{ filteredAlerts.length }}</span>
        </div>

        <div class="card-body p-0">
          <!-- Message si aucune alerte -->
          <div *ngIf="filteredAlerts.length === 0" class="text-center py-5">
            <i class="bi bi-check-circle text-success fs-1"></i>
            <h5 class="mt-3 text-muted">Aucune alerte</h5>
            <p class="text-muted" *ngIf="filterStatus === 'active'">
              Aucune anomalie d√©tect√©e - Toutes les stations fonctionnent normalement
            </p>
            <p class="text-muted" *ngIf="filterStatus === 'resolved'">
              Aucune alerte r√©solue pour le moment
            </p>
            <p class="text-muted" *ngIf="filterStatus === 'all'">
              Aucune alerte dans le syst√®me
            </p>
          </div>

          <!-- Liste des alertes -->
          <div class="list-group list-group-flush">
            <div *ngFor="let alert of filteredAlerts"
                 class="list-group-item alert-item"
                 [class.border-start-danger]="alert.severity === 'critical' && alert.status === 'active'"
                 [class.border-start-warning]="alert.severity === 'high' && alert.status === 'active'"
                 [class.border-start-info]="alert.severity === 'medium' && alert.status === 'active'"
                 [class.border-start-secondary]="alert.severity === 'low' && alert.status === 'active'"
                 [class.resolved]="alert.status === 'resolved'">
              <div class="row align-items-center">
                <div class="col-md-1 text-center">
                  <i class="fs-2" [ngClass]="getSeverityIcon(alert.severity)"
                     [class.text-danger]="alert.severity === 'critical'"
                     [class.text-warning]="alert.severity === 'high'"
                     [class.text-info]="alert.severity === 'medium'"
                     [class.text-secondary]="alert.severity === 'low'"></i>
                </div>

                <div class="col-md-7">
                  <div class="d-flex align-items-center mb-2">
                    <span class="badge me-2" [ngClass]="getSeverityClass(alert.severity)">
                      {{ alert.severity === 'critical' ? 'CRITIQUE' :
                         alert.severity === 'high' ? '√âLEV√âE' :
                         alert.severity === 'medium' ? 'MOYENNE' :
                         alert.severity === 'low' ? 'FAIBLE' :
                         alert.severity.toUpperCase() }}
                    </span>
                    <span class="badge bg-secondary">{{ alert.type }}</span>
                  </div>
                  <h6 class="mb-1 fw-bold">
                    <i class="bi bi-geo-alt-fill text-primary me-1"></i>
                    {{ alert.station }}
                  </h6>
                  <p class="mb-1">{{ alert.message }}</p>
                  <div class="d-flex align-items-center text-muted">
                    <small>
                      <i class="bi bi-clock me-1"></i>
                      {{ getTimeAgo(alert.timestamp) }}
                    </small>
                    <small *ngIf="alert.parameter" class="ms-3">
                      <i class="bi bi-speedometer2 me-1"></i>
                      Param√®tre: {{ alert.parameter }}
                      <span *ngIf="alert.value">
                        ({{ alert.value.toFixed(2) }}
                        <span *ngIf="alert.threshold"> / Seuil: {{ alert.threshold }}</span>)
                      </span>
                    </small>
                  </div>
                  <span *ngIf="alert.status === 'resolved'" class="badge bg-success mt-2">
                    <i class="bi bi-check-circle me-1"></i>R√©solue
                  </span>
                </div>

                <div class="col-md-4 text-end">
                  <button *ngIf="alert.status === 'active'"
                          class="btn btn-success"
                          (click)="resolveAlert(alert)">
                    <i class="bi bi-check-lg me-1"></i>
                    Marquer comme r√©solue
                  </button>
                  <div *ngIf="alert.status === 'resolved'" class="text-success">
                    <i class="bi bi-check-circle-fill fs-3"></i>
                    <p class="mb-0 mt-2">
                      <small>R√©solue</small>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- L√©gende des normes de qualit√© -->
<div class="card mt-5 shadow-sm border-0">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">
      <i class="bi bi-clipboard-data me-2"></i>
      üìä L√©gende des Normes de Qualit√© de l'Eau
    </h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr class="text-center">
            <th>Param√®tre</th>
            <th>Unit√©</th>
            <th>
              <span class="badge bg-success">Normale</span>
            </th>
            <th>
              <span class="badge bg-warning text-dark">√âlev√©e</span>
            </th>
            <th>
              <span class="badge bg-danger">Critique</span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong><i class="bi bi-droplet me-1 text-info"></i> pH</strong></td>
            <td>‚Äî</td>
            <td class="text-center text-success fw-bold">6,5 ‚Äì 8,5</td>
            <td class="text-center text-warning fw-bold">&lt; 6,5 ou &gt; 9,5</td>
            <td class="text-center text-danger fw-bold">&lt; 5 ou &gt; 10</td>
          </tr>
          <tr>
            <td><strong><i class="bi bi-thermometer me-1 text-danger"></i> Temp√©rature</strong></td>
            <td>¬∞C</td>
            <td class="text-center text-success fw-bold">20 ‚Äì 30</td>
            <td class="text-center text-warning fw-bold">30 ‚Äì 35</td>
            <td class="text-center text-danger fw-bold">&gt; 35</td>
          </tr>
          <tr>
            <td><strong><i class="bi bi-wind me-1 text-primary"></i> Oxyg√®ne dissous</strong></td>
            <td>mg/L</td>
            <td class="text-center text-success fw-bold">&gt; 5</td>
            <td class="text-center text-warning fw-bold">3 ‚Äì 5</td>
            <td class="text-center text-danger fw-bold">&lt; 3</td>
          </tr>
          <tr>
            <td><strong><i class="bi bi-recycle me-1 text-secondary"></i> DBO‚ÇÖ</strong></td>
            <td>mg/L</td>
            <td class="text-center text-success fw-bold">&lt; 25</td>
            <td class="text-center text-warning fw-bold">25 ‚Äì 40</td>
            <td class="text-center text-danger fw-bold">&gt; 40</td>
          </tr>
          <tr>
            <td><strong><i class="bi bi-flask me-1 text-warning"></i> DCO</strong></td>
            <td>mg/L</td>
            <td class="text-center text-success fw-bold">&lt; 125</td>
            <td class="text-center text-warning fw-bold">125 ‚Äì 250</td>
            <td class="text-center text-danger fw-bold">&gt; 250</td>
          </tr>
          <tr>
            <td><strong><i class="bi bi-exclamation-triangle me-1 text-info"></i> Nitrates (NO‚ÇÉ‚Åª)</strong></td>
            <td>mg/L</td>
            <td class="text-center text-success fw-bold">&lt; 25</td>
            <td class="text-center text-warning fw-bold">25 ‚Äì 50</td>
            <td class="text-center text-danger fw-bold">&gt; 50</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="card-footer bg-light">
    <div class="row align-items-center">
      <div class="col-md-8">
        <p class="mb-0 text-muted">
          <i class="bi bi-info-circle me-1 text-primary"></i>
          Ces valeurs de r√©f√©rence sont bas√©es sur les recommandations de l'OMS et des normes environnementales locales.
        </p>
      </div>
      <div class="col-md-4 text-md-end">
        <div class="btn-group btn-group-sm" role="group">
          <button type="button" class="btn btn-success">Normale</button>
          <button type="button" class="btn btn-warning">√âlev√©e</button>
          <button type="button" class="btn btn-danger">Critique</button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<style>
  .alert-item {
    border-left: 4px solid transparent !important;
    padding: 1.5rem;
    transition: all 0.3s;
  }

  .alert-item:hover {
    background-color: #f8f9fa;
    transform: translateX(5px);
  }

  .alert-item.resolved {
    opacity: 0.6;
    background-color: #f0f0f0;
  }

  .border-start-danger {
    border-left-color: #dc3545 !important;
  }

  .border-start-warning {
    border-left-color: #ffc107 !important;
  }

</style>
